---
title: "p8105_hw2_rh2916"
author: "Rui Huang"
date: "September 29, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(skimr)
library(dplyr)
library(readxl)
```

## Problem 1 

## Read and manipulate Data 

```{r}
Problem1_data =
  read_csv(file = './data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv') %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, route1: route11, 
         entry, vending, entrance_type, ada) %>%
  mutate(
    entry = recode(entry, "YES" = TRUE, "NO" = FALSE)
  )
```

The Problem1_data dataset contains 19 variables, they are line, station_name, station_latitude, station_ongitude, routes1:route11, entry, vending, entrance type and ada. After reading the dataset, I first clean the variable names using clean_names function, then retain the variables I need by select function, and convert the entry variable from character to a logical variable by mutate and recode function. The dimension of the resulting dataset is `r dim(Problem1_data)` (rows x columns). It is not tidy since the route name and route number are messy.


## How many distinct stations are there? 

```{r}
Problem1_data %>% 
  distinct(line, station_name) %>% 
  nrow()
```
There are 465 stations.

## How many stations are ADA compliant?

```{r}
Problem1_data %>% 
  filter(ada == "TRUE") %>%
  distinct(line, station_name) %>% 
  nrow()
```
84 stations are ADA compliant.


## What proportion of station entrances / exits without vending allow entrance?


```{r}
Problem1_data_novending_entrance =
  Problem1_data %>% 
  filter(vending == "NO" & entry == TRUE) %>%
  distinct(line, station_name)
Problem1_data_novending = 
  Problem1_data %>%
  filter(vending == "NO") %>%
  distinct(line, station_name) 
nrow(Problem1_data_novending_entrance)/nrow(Problem1_data_novending)
```

43.43% of station entrances / exits without vending allow entrance.

## Reformat route variables.

```{r}
Problem1_data %>%
  gather(key = route_number, value = route_name, route1:route11) %>%
  filter(route_name == "A") %>%
  distinct(line, station_name) %>%
  nrow()
```
```{r}
Problem1_data %>%
  gather(key = route_number, value = route_name, route1:route11) %>%
  filter(route_name == "A" & ada == TRUE) %>%
  distinct(line, station_name) %>%
  nrow()
```

60 distinct stations serve the A train. 
Of the stations that serve the A train, 17 stations are ADA compliant.


## Problem 2

## Read and clean the Mr. Trash Wheel sheet:

```{r}
problem2_data_dumpster = 
  readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N258") %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls)
  )
```

## Read, clean and combine precipitation data for 2016 and 2017. 

```{r}
problem2_data_2016 = 
  readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = 
                      "2016 Precipitation", range = "A2:B14") %>%
  janitor::clean_names() %>%
  filter(!is.na(total)) %>%
  mutate(
    year = 2016
  )
```

```{r}
problem2_data_2017 = 
  readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = 
                      "2017 Precipitation", range = "A2:B14") %>%
  janitor::clean_names() %>%
  filter(!is.na(total)) %>%
  mutate(
    year = 2017
  )
```

```{r}
problem2_data_rbind = rbind(problem2_data_2016, problem2_data_2017) 
problem2_data_rbind$month = month.name[problem2_data_rbind$month]
```

## Explanation of the datasets

For problem2_data_dumpster, the number of observations is `r nrow(problem2_data_dumpster)`. The key variables are dumpster, date, weight_tons and volume_cubic_yards. By the key variables, we can know the general information of the dumpster. For problem2_data_rbind, the number of observations is `r nrow(problem2_data_rbind)`. The three variables, total, month and year are all key variables to know the general information about the precipitation.

## What was the total precipitation in 2017? 

For available data, the total precipitation in 2017 was `r sum(problem2_data_2017$total)`. 

## What was the median number of sports balls in a dumpster in 2016?

The median number of sports balls in a dumpster in 2016 is `r median(subset(problem2_data_dumpster, year== 2016)$sports_balls) `.


## Problem 3

## Read and manipulate data

```{r}
library(p8105.datasets)
data(brfss_smart2010)
```

```{r}
problem3_data =
  brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health" ) %>%
  select(-class, -topic, -question, -sample_size, -(confidence_limit_low :    geo_location)) %>%
  spread(key = response, value = data_value) %>%
  janitor::clean_names() %>%
  mutate(    
    proportion_of_excellent = excellent/ (excellent + fair + good + poor + very_good),
    proportion_of_very_good = very_good / (excellent + fair + good + poor + very_good)
  )
```

## How many unique locations?  What state is observed the most?

```{r}
problem3_data %>%
  distinct(locationdesc) %>%
  nrow()
problem3_data %>%
  distinct(locationabbr) %>%
  nrow()
mode <- function(x) {
    ux <- unique(x)
    ux[which.max(tabulate(match(x, ux)))]
}
mode(problem3_data$locationabbr)
```

404 unique locations are included in the dataset. 51 states are represented which means every state is represented. The state "NJ" is observed the most.

## In 2002, what is the median of the “Excellent” response value?

```{r}
median(problem3_data$excellent, na.rm = TRUE)
```

In 2002, the median of the “Excellent” response value is 22.

Make a histogram of “Excellent” response values in the year 2002.
```{r}
problem3_data_2002 = 
  filter(problem3_data, year == 2002)
ggplot(problem3_data_2002, aes(x = excellent)) + 
  geom_histogram() +
  ggtitle("Histogram of “Excellent” response values in the year 2002")
```

Make a scatterplot showing the proportion of “Excellent” response values in New York County and Queens County (both in NY State) in each year from 2002 to 2010.
```{r}
problem3_data_scat = 
  filter(problem3_data, locationdesc == "NY - New York County" | locationdesc == "NY - Queens County")
ggplot(problem3_data_scat, aes(x = year, y = proportion_of_excellent, color = locationdesc)) + 
  geom_point() +
  ggtitle("Scatterplot of the proportion of “Excellent” response values in New York County and Queens County") +
  theme(legend.position = "bottom")
```


