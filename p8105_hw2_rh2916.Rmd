---
title: "p8105_hw2_rh2916"
author: "Rui Huang"
date: "September 29, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(skimr)
library(dplyr)
library(readxl)
```

## Problem 1 

## Read and manipulate Data 

```{r}
Problem1_data =
  read_csv(file = './data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv') %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, route1: route11, 
         entry, vending, entrance_type, ada) %>%
  mutate(
    entry = recode(entry, "YES" = TRUE, "NO" = FALSE)
  )
```

The Problem1_data dataset contains 19 variables, they are line, station_name, station_latitude, station_ongitude, routes1:route11, entry, vending, entrance type and ada. After reading the dataset, I first clean the variable names using clean_names function, then retain the variables I need by select function, and convert the entry variable from character to a logical variable by mutate and recode function. The dimension of the resulting dataset is `r dim(Problem1_data)` (rows x columns). It is not tidy since the route name and route number are messy.


## How many distinct stations are there? 

```{r}
Problem1_data %>% 
  distinct(line, station_name) %>% 
  nrow()
```
There are 465 stations.

## How many stations are ADA compliant?

```{r}
Problem1_data %>% 
  filter(ada == "TRUE") %>%
  distinct(line, station_name) %>% 
  nrow()
```
84 stations are ADA compliant.


## What proportion of station entrances / exits without vending allow entrance?


```{r}
Problem1_data_novending_entrance =
  Problem1_data %>% 
  filter(vending == "NO" & entry == TRUE) %>%
  distinct(line, station_name)
Problem1_data_novending = 
  Problem1_data %>%
  filter(vending == "NO") %>%
  distinct(line, station_name) 
nrow(Problem1_data_novending_entrance)/nrow(Problem1_data_novending)
```

43.43% of station entrances / exits without vending allow entrance.

## Reformat route variables.

```{r}
Problem1_data %>%
  gather(key = route_number, value = route_name, route1:route11) %>%
  filter(route_name == "A") %>%
  distinct(line, station_name) %>%
  nrow()
```
```{r}
Problem1_data %>%
  gather(key = route_number, value = route_name, route1:route11) %>%
  filter(route_name == "A" & ada == TRUE) %>%
  distinct(line, station_name) %>%
  nrow()
```

60 distinct stations serve the A train. 
Of the stations that serve the A train, 17 stations are ADA compliant.


## Problem 2

## Read and clean the Mr. Trash Wheel sheet:

```{r}
problem2_data_dumpster = 
  readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N258") %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls)
  )
```

## Read, clean and combine precipitation data for 2016 and 2017. 

```{r}
problem2_data_2016 = 
  readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = 
                      "2016 Precipitation", range = "A2:B14") %>%
  janitor::clean_names() %>%
  filter(!is.na(total)) %>%
  mutate(
    year = 2016
  )
```

```{r}
problem2_data_2017 = 
  readxl::read_xlsx("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = 
                      "2017 Precipitation", range = "A2:B14") %>%
  janitor::clean_names() %>%
  filter(!is.na(total)) %>%
  mutate(
    year = 2017
  )
```

```{r}
problem2_data_rbind = rbind(problem2_data_2016, problem2_data_2017) 
problem2_data_rbind$month = month.name[problem2_data_rbind$month]
```

## Explanation of the datasets

For problem2_data_dumpster, the number of observations is `r nrow(problem2_data_dumpster)`. The key variables are dumpster, date, weight_tons and volume_cubic_yards. By the key variables, we can know the general information of the dumpster. For problem2_data_rbind, the number of observations is `r nrow(problem2_data_rbind)`. The three variables, total, month and year are all key variables to know the general information about the precipitation.

## What was the total precipitation in 2017? 

For available data, the total precipitation in 2017 was `r sum(problem2_data_2017$total)`. 

## What was the median number of sports balls in a dumpster in 2016?

The median number of sports balls in a dumpster in 2016 is `r median(subset(problem2_data_dumpster, year== 2016)$sports_balls) `.